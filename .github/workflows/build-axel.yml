name: Cross-compile Axel for Windows

on:
  push:
    tags: ['v*']
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Install cross-compilation tools
      run: |
        sudo apt-get update
        sudo apt-get install -y \
          gcc-mingw-w64-x86-64 \
          g++-mingw-w64-x86-64 \
          autoconf automake libtool \
          pkg-config wget tar
        
    - name: Download and build Axel
      run: |
        wget https://github.com/axel-download-accelerator/axel/releases/download/v2.17.11/axel-2.17.11.tar.gz
        tar -xzf axel-2.17.11.tar.gz
        cd axel-2.17.11
        
        # 为 Windows 交叉编译配置
        ./configure \
          --host=x86_64-w64-mingw32 \
          --disable-shared \
          --enable-static \
          CFLAGS="-static -Os -DWIN32 -D_WIN32_WINNT=0x0600" \
          LDFLAGS="-static -lws2_32"
          
        make -j$(nproc)
        
    - name: Upload Windows binary
      uses: actions/upload-artifact@v4
      with:
        name: axel-windows-cross-compiled
        path: axel-2.17.11/src/axel.exe
